import{r as C,c,b as n,d as M,e as s,w as l,E as F,t as u,F as y,h as R,i as B,o as m,f as _,j as I,k as N,l as D,g as i,a as f}from"./index-C2VwTE3s.js";import{E as L,h as g}from"./http-K1XqM7fZ.js";import{M as S}from"./index-BMSQkwth.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"buttons"},$={class:"status"},j={class:"content"},A={style:{color:"red"}},O={class:"buttons"},W=["innerHTML"],q={__name:"Multi",setup(z){const t=C({btnRecordText:"开始收音",status:"",type:"请选择",prompt:"",stts:[],result:"",loading:!1}),k=S();function v(){switch(t.type){case"请选择":t.prompt="",i.error("请选择生成类型");break;case"病例生成":t.prompt="<对话>为患者和医生的对话，根据<对话>生成一份完成的病例";break;case"自定义":t.prompt="";break}}let d=!1;function x(){d?f.stop(async()=>{i.success("停止收音"),t.btnRecordText="开始收音",d=!1,t.status="正在处理...";const r=f.getWAVBlob(),e=new File([r],"audio.wav"),o=new FormData;o.append("file",e);const a=await g.post("/api/asrm",o,{headers:{"Content-Type":"multipart/form-data"}});t.stts=a.data.data[0].sentence_info,t.status=""}):f.start(()=>{i.success("开始收音"),t.btnRecordText="停止收音",t.status="正在收音...",d=!0},()=>{i.error("收音错误"),t.status="",t.btnRecordText="开始收音",d=!1})}function w(){t.status="",t.prompt="",t.type="请选择",t.stts=[]}async function V(){if(t.type=="请选择"){i.error("请选择生成类型");return}if(t.prompt==""){i.error("请输入提示词");return}t.loading=!0;let r=`<对话>
`;for(const a of t.stts)r+=`说话人${a.spk}：${a.text}
`;r+=`</对话>
`;const e=r+t.prompt,o=await g.post("/api/asrg",{prompt:e});t.result=k.render(o.data.data.replace(/<think>[\s\S]*?<\/think>/g,"")),t.loading=!1}return(r,e)=>{const o=F,a=D,h=N,b=I,E=L,T=B;return m(),c(y,null,[e[4]||(e[4]=n("div",{class:"title"},"多人对话",-1)),n("div",U,[s(o,{type:"primary",onClick:x},{default:l(()=>[_(u(t.btnRecordText),1)]),_:1}),s(o,{type:"primary",onClick:w},{default:l(()=>e[2]||(e[2]=[_("清空内容")])),_:1,__:[2]}),n("span",$,u(t.status),1)]),n("div",j,[(m(!0),c(y,null,R(t.stts,p=>(m(),c("div",null,[n("span",A,"说话人"+u(p.spk)+"：",1),_(" "+u(p.text),1)]))),256))]),n("div",O,[s(T,{"label-width":"auto"},{default:l(()=>[s(b,{label:"生成类型"},{default:l(()=>[s(h,{modelValue:t.type,"onUpdate:modelValue":e[0]||(e[0]=p=>t.type=p),placeholder:"生成类型",onChange:v},{default:l(()=>[s(a,{label:"请选择",value:"请选择"}),s(a,{label:"病例生成",value:"病例生成"}),s(a,{label:"自定义",value:"自定义"})]),_:1},8,["modelValue"])]),_:1}),s(b,{label:"提示词"},{default:l(()=>[s(E,{modelValue:t.prompt,"onUpdate:modelValue":e[1]||(e[1]=p=>t.prompt=p),rows:5,type:"textarea",placeholder:"请输入多人对话生成内容提示词，对话内容为<对话>"},null,8,["modelValue"])]),_:1})]),_:1}),n("div",null,[s(o,{type:"primary",loading:t.loading,onClick:V},{default:l(()=>e[3]||(e[3]=[_("对话内容生成")])),_:1,__:[3]},8,["loading"])])]),t.result?(m(),c("div",{key:0,innerHTML:t.result,class:"result"},null,8,W)):M("",!0)],64)}}},Q=H(q,[["__scopeId","data-v-e2d65f8e"]]);export{Q as default};
