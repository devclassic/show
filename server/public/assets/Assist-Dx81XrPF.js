import{r as v,aC as w,c as n,a as r,d,w as p,t as m,F as x,as as R,o as l,e as f,Y as g}from"./index-Cd8BDsyL.js";import{E as V,a as u,h as y}from"./http-DGZGRwHc.js";import{E as C}from"./el-input-DPsbHVgQ.js";import{M as E}from"./index-BMSQkwth.js";import{a as _}from"./asr-5o_LRsin.js";/* empty css                   */import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"input"},F={class:"buttons"},H={class:"status"},A={ref:"content",class:"content"},D={key:0,style:{color:"blue"}},I=["innerHTML"],L={__name:"Assist",setup(N){const t=v({contentRef:w("content"),status:"",loading:!1,text:"",btnRecordText:"开始收音",messages:[{role:"user",content:"你好"},{role:"ai",content:"你好"}]}),b=E();t.messages=[];function h(){t.text="",t.messages=[]}async function T(){if(!t.text){u.error("请输入内容");return}t.messages.push({role:"user",content:t.text});const c=t.text;t.text="",await g(),t.contentRef.scrollTo({top:t.contentRef.scrollHeight,behavior:"smooth"}),t.loading=!0;const s=(await y.post("/api/assist",{question:c})).data.data.replace(/<think>[\s\S]*?<\/think>/g,"");t.messages.push({role:"ai",content:b.render(s)}),await g(),t.contentRef.scrollTo({top:t.contentRef.scrollHeight,behavior:"smooth"}),t.loading=!1}let i=!1;function k(){i?_.stop(async()=>{u.success("停止收音"),t.status="正在识别...",t.btnRecordText="开始收音",i=!1;const c=_.getWAVBlob(),e=new File([c],"audio.wav"),s=new FormData;s.append("file",e);const a=await y.post("/api/asr",s,{headers:{"Content-Type":"multipart/form-data"}});t.status="",t.text=a.data.data[0].text}):_.start(()=>{u.success("开始收音"),t.btnRecordText="停止收音",t.status="正在收音...",i=!0},()=>{u.error("收音错误"),t.status="",t.btnRecordText="开始收音",i=!1})}return(c,e)=>{const s=C,a=V;return l(),n(x,null,[e[3]||(e[3]=r("div",{class:"title"},"辅助诊疗",-1)),r("div",M,[d(s,{modelValue:t.text,"onUpdate:modelValue":e[0]||(e[0]=o=>t.text=o),rows:5,type:"textarea",placeholder:"请输入内容用于辅助诊疗"},null,8,["modelValue"])]),r("div",F,[d(a,{type:"primary",loading:t.loading,onClick:T},{default:p(()=>e[1]||(e[1]=[f("辅助诊疗")])),_:1,__:[1]},8,["loading"]),d(a,{type:"primary",onClick:k},{default:p(()=>[f(m(t.btnRecordText),1)]),_:1}),d(a,{type:"primary",onClick:h},{default:p(()=>e[2]||(e[2]=[f("清空内容")])),_:1,__:[2]}),r("span",H,m(t.status),1)]),r("div",A,[(l(!0),n(x,null,R(t.messages,o=>(l(),n("div",{key:o.role},[o.role=="user"?(l(),n("div",D,m(o.content),1)):(l(),n("div",{key:1,style:{color:"red"},innerHTML:o.content},null,8,I))]))),128))],512)],64)}}},G=B(L,[["__scopeId","data-v-69e7aeb0"]]);export{G as default};
