import{r as V,aC as M,X as B,c as d,a as r,d as i,w as l,F as p,as as c,o as n,G as N,b as h,e as m,J as R}from"./index-CS1yAV3M.js";import{E as T,d as H}from"./el-form-item-BaT_uGnx.js";import{E as J}from"./el-input-BVKcpiHK.js";import{h as f,E as z,a as u}from"./http-Cizd94wU.js";import{M as A}from"./index-BMSQkwth.js";/* empty css                   */import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"input"},S={class:"item"},X=["src"],j={class:"result"},q={key:0,class:"msgimg"},K={class:"msgimgitme"},P=["src"],Q=["innerHTML"],W={__name:"Image",setup(Y){const b="",x=A(),e=V({loadingInitModel:!1,loadingUninitModel:!1,isLoadingModel:!1,loading:!1,uploading:!1,file:M("file"),filedcm:M("filedcm"),files:[],images:[],text:"",messages:[],history:[{role:"system",content:[{type:"text",text:"你是端点科技医疗影像助手，你需要根据用户的症状和影像，给出诊断建议和治疗建议。用中文回答用户问题。"}]}],paths:[]});B(async()=>{const s=await f.post("/api/is-image-model-init");e.isLoadingModel=s.data.data});async function C(){e.loadingInitModel=!0;const s=await f.post("/api/init-image-model");s.data.success?(u.success("模型加载成功"),e.isLoadingModel=!0):u.error(s.data.message),e.loadingInitModel=!1}async function L(){e.loadingUninitModel=!0;const s=await f.post("/api/uninit-image-model");s.data.success?(u.success("模型卸载成功"),e.isLoadingModel=!1,_()):u.error(s.data.message),e.loadingUninitModel=!1}function k(){e.file.click()}function w(){e.filedcm.click()}function v(){e.uploading=!0,e.images=[],e.files=e.file.files;for(const s of e.files){const a=new FileReader;a.onload=t=>{e.images.push(t.target.result)},a.readAsDataURL(s)}e.uploading=!1}async function I(){e.uploading=!0;const s=new FormData;for(const t of e.filedcm.files)s.append("files",t);const a=await f.post("/api/updcm",s);a.data.success?(e.images=a.data.data.images.map(t=>b+t),e.paths=a.data.data.paths):u.error(a.data.message),e.uploading=!1}async function E(){e.loading=!0,e.messages.push({role:"user",images:e.images,content:e.text}),e.images=[];const s=new FormData;for(let t=0;t<e.file.files.length;t++)s.append("files",e.file.files[t]);s.append("text",e.text),s.append("history",JSON.stringify(e.history)),s.append("paths",e.paths),e.text="";const a=await f.post("/api/image",s);e.messages.push({role:"assistant",content:x.render(a.data.data.text)}),e.history=a.data.data.history,e.loading=!1,e.file.value="",e.filedcm.value="",e.paths=[]}async function _(){e.messages=[],e.images=[],e.file.value="",e.filedcm.value="",e.text="",e.history=[{role:"system",content:[{type:"text",text:"你是端点科技医疗影像助手，你需要根据用户的症状和影像，给出诊断建议和治疗建议。用中文回答用户问题。"}]}]}return(s,a)=>{const t=z,g=H,D=J,F=T;return n(),d(p,null,[a[7]||(a[7]=r("div",{class:"title"},"医学影像",-1)),r("div",O,[i(F,{"label-width":"auto"},{default:l(()=>[i(g,{label:"模型"},{default:l(()=>[i(t,{type:"primary",onClick:C,loading:e.loadingInitModel,disabled:e.isLoadingModel},{default:l(()=>a[1]||(a[1]=[m(" 加载模型 ")])),_:1,__:[1]},8,["loading","disabled"]),i(t,{type:"primary",onClick:L,loading:e.loadingUninitModel,disabled:!e.isLoadingModel},{default:l(()=>a[2]||(a[2]=[m(" 卸载模型 ")])),_:1,__:[2]},8,["loading","disabled"])]),_:1}),e.images.length?(n(),N(g,{key:0,label:"影像",class:"imgitem"},{default:l(()=>[(n(!0),d(p,null,c(e.images,o=>(n(),d("span",S,[r("img",{src:o,height:"100",class:"img"},null,8,X)]))),256))]),_:1})):h("",!0),i(g,{label:"操作"},{default:l(()=>[r("input",{type:"file",ref:"file",onChange:v,class:"file",multiple:""},null,544),r("input",{type:"file",ref:"filedcm",onChange:I,class:"file",multiple:""},null,544),i(t,{type:"primary",loading:e.uploading,onClick:k,disabled:!e.isLoadingModel},{default:l(()=>a[3]||(a[3]=[m(" 上传图片 ")])),_:1,__:[3]},8,["loading","disabled"]),i(t,{type:"primary",loading:e.uploading,onClick:w,disabled:!e.isLoadingModel},{default:l(()=>a[4]||(a[4]=[m(" 上传DCM ")])),_:1,__:[4]},8,["loading","disabled"]),i(t,{type:"primary",onClick:E,loading:e.loading,disabled:!e.isLoadingModel},{default:l(()=>a[5]||(a[5]=[m(" 提交 ")])),_:1,__:[5]},8,["loading","disabled"]),i(t,{type:"primary",onClick:_,disabled:!e.isLoadingModel},{default:l(()=>a[6]||(a[6]=[m("重置")])),_:1,__:[6]},8,["disabled"])]),_:1}),i(g,{label:"提示词"},{default:l(()=>[i(D,{modelValue:e.text,"onUpdate:modelValue":a[0]||(a[0]=o=>e.text=o),rows:5,type:"textarea",placeholder:"请输入症状用于智能导诊"},null,8,["modelValue"])]),_:1})]),_:1})]),r("div",j,[(n(!0),d(p,null,c(e.messages,o=>{var y;return n(),d("div",{class:R([{user:o.role==="user",assistant:o.role==="assistant"},"item"])},[(y=o.images)!=null&&y.length?(n(),d("div",q,[(n(!0),d(p,null,c(o.images,U=>(n(),d("span",K,[r("img",{src:U,height:"100",class:"img"},null,8,P)]))),256))])):h("",!0),r("div",{innerHTML:o.content},null,8,Q)],2)}),256))])],64)}}},le=G(W,[["__scopeId","data-v-4ffffad6"]]);export{le as default};
