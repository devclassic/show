import{r as M,aC as g,c as o,a as n,d as r,w as m,F as f,as as u,o as i,G as B,b as _,e as p,J as L}from"./index-1kvfw-El.js";import{E as N,d as R}from"./el-form-item-B2rR_mOK.js";import{E as T}from"./el-input-CSxWa6D0.js";import{E as U,h,a as y}from"./el-message-BAv3Oocr.js";import{M as H}from"./index-BMSQkwth.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"input"},A={class:"item"},G=["src"],O={class:"result"},S={key:0,class:"msgimg"},j={class:"msgimgitme"},q=["src"],K=["innerHTML"],P={__name:"Image",setup(Q){const x="",C=H(),e=M({loading:!1,uploading:!1,file:g("file"),filedcm:g("filedcm"),files:[],images:[],text:"",messages:[],history:[{role:"system",content:[{type:"text",text:"你是端点科技医疗影像助手，你需要根据用户的症状和影像，给出诊断建议和治疗建议。用中文回答用户问题。"}]}],paths:[]});function k(){e.file.click()}function v(){e.filedcm.click()}function w(){e.uploading=!0,e.images=[],e.files=e.file.files;for(const a of e.files){const t=new FileReader;t.onload=s=>{e.images.push(s.target.result)},t.readAsDataURL(a)}e.uploading=!1}async function b(){e.uploading=!0;const a=new FormData;for(const s of e.filedcm.files)a.append("files",s);const t=await h.post("/api/updcm",a);t.data.success?(e.images=t.data.data.images.map(s=>x+s),e.paths=t.data.data.paths):y.error(t.data.message),e.uploading=!1}async function E(){e.loading=!0,e.messages.push({role:"user",images:e.images,content:e.text}),e.images=[];const a=new FormData;for(let s=0;s<e.file.files.length;s++)a.append("files",e.file.files[s]);a.append("text",e.text),a.append("history",JSON.stringify(e.history)),a.append("paths",e.paths),e.text="";const t=await h.post("/api/image",a);e.messages.push({role:"assistant",content:C.render(t.data.data.text)}),e.history=t.data.data.history,e.loading=!1,e.file.value="",e.filedcm.value="",e.paths=[]}async function D(){e.messages=[],e.images=[],e.file.value="",e.filedcm.value="",e.text="",e.history=[{role:"system",content:[{type:"text",text:"你是端点科技医疗影像助手，你需要根据用户的症状和影像，给出诊断建议和治疗建议。用中文回答用户问题。"}]}],y.success("重置成功")}return(a,t)=>{const s=R,d=U,F=T,V=N;return i(),o(f,null,[t[5]||(t[5]=n("div",{class:"title"},"医学影像",-1)),n("div",z,[r(V,{"label-width":"auto"},{default:m(()=>[e.images.length?(i(),B(s,{key:0,label:"影像",class:"imgitem"},{default:m(()=>[(i(!0),o(f,null,u(e.images,l=>(i(),o("span",A,[n("img",{src:l,height:"100",class:"img"},null,8,G)]))),256))]),_:1})):_("",!0),r(s,{label:"操作"},{default:m(()=>[n("input",{type:"file",ref:"file",onChange:w,class:"file",multiple:""},null,544),n("input",{type:"file",ref:"filedcm",onChange:b,class:"file",multiple:""},null,544),r(d,{type:"primary",loading:e.uploading,onClick:k},{default:m(()=>t[1]||(t[1]=[p("上传图片")])),_:1,__:[1]},8,["loading"]),r(d,{type:"primary",loading:e.uploading,onClick:v},{default:m(()=>t[2]||(t[2]=[p(" 上传DCM ")])),_:1,__:[2]},8,["loading"]),r(d,{type:"primary",onClick:E,loading:e.loading},{default:m(()=>t[3]||(t[3]=[p("提交")])),_:1,__:[3]},8,["loading"]),r(d,{type:"primary",onClick:D},{default:m(()=>t[4]||(t[4]=[p("重置")])),_:1,__:[4]})]),_:1}),r(s,{label:"提示词"},{default:m(()=>[r(F,{modelValue:e.text,"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),rows:5,type:"textarea",placeholder:"请输入症状用于智能导诊"},null,8,["modelValue"])]),_:1})]),_:1})]),n("div",O,[(i(!0),o(f,null,u(e.messages,l=>{var c;return i(),o("div",{class:L([{user:l.role==="user",assistant:l.role==="assistant"},"item"])},[(c=l.images)!=null&&c.length?(i(),o("div",S,[(i(!0),o(f,null,u(l.images,I=>(i(),o("span",j,[n("img",{src:I,height:"100",class:"img"},null,8,q)]))),256))])):_("",!0),n("div",{innerHTML:l.content},null,8,K)],2)}),256))])],64)}}},te=J(P,[["__scopeId","data-v-c5db019f"]]);export{te as default};
