import{r as B,aC as g,c as o,a as m,d as n,w as r,F as u,as as f,o as i,G as I,b as _,e as d,J as N,t as R}from"./index-CdTik-5j.js";import{E as L,d as U}from"./el-form-item-DfUAFrTS.js";import{E as J}from"./el-input-B0NEveY9.js";import{E as M,h as y,a as h}from"./el-message-BgJcoQvx.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"input"},z={class:"item"},A=["src"],G={class:"result"},O={key:0,class:"msgimg"},j={class:"msgimgitme"},q=["src"],H={__name:"Image",setup(K){const x="",e=B({loading:!1,uploading:!1,file:g("file"),filedcm:g("filedcm"),files:[],images:[],text:"",messages:[],history:[{role:"user",content:[{type:"text",text:"用中文回答用户问题"}]},{role:"user",content:[{type:"text",text:"你是端点科技医疗影像助手"}]}],paths:[]});function C(){e.file.click()}function k(){e.filedcm.click()}function v(){e.uploading=!0,e.images=[],e.files=e.file.files;for(const a of e.files){const t=new FileReader;t.onload=s=>{e.images.push(s.target.result)},t.readAsDataURL(a)}e.uploading=!1}async function w(){e.uploading=!0;const a=new FormData;for(const s of e.filedcm.files)a.append("files",s);const t=await y.post("/api/updcm",a);t.data.success?(e.images=t.data.data.images.map(s=>x+s),e.paths=t.data.data.paths):h.error(t.data.message),e.uploading=!1}async function E(){e.loading=!0,e.messages.push({role:"user",images:e.images,content:e.text}),e.images=[];const a=new FormData;for(let s=0;s<e.file.files.length;s++)a.append("files",e.file.files[s]);a.append("text",e.text),a.append("history",JSON.stringify(e.history)),a.append("paths",e.paths),e.text="";const t=await y.post("/api/image",a);e.messages.push({role:"assistant",content:t.data.data.text}),e.history=t.data.data.history,e.loading=!1,e.file.value="",e.filedcm.value="",e.paths=[]}async function b(){e.messages=[],e.images=[],e.file.value="",e.filedcm.value="",e.text="",e.history=[{role:"user",content:[{type:"text",text:"用中文回答用户问题"}]},{role:"user",content:[{type:"text",text:"你是端点科技医疗影像助手"}]}],h.success("重置成功")}return(a,t)=>{const s=U,p=M,D=J,F=L;return i(),o(u,null,[t[5]||(t[5]=m("div",{class:"title"},"医学影像",-1)),m("div",T,[n(F,{"label-width":"auto"},{default:r(()=>[e.images.length?(i(),I(s,{key:0,label:"影像",class:"imgitem"},{default:r(()=>[(i(!0),o(u,null,f(e.images,l=>(i(),o("span",z,[m("img",{src:l,height:"100",class:"img"},null,8,A)]))),256))]),_:1})):_("",!0),n(s,{label:"操作"},{default:r(()=>[m("input",{type:"file",ref:"file",onChange:v,class:"file",multiple:""},null,544),m("input",{type:"file",ref:"filedcm",onChange:w,class:"file",multiple:""},null,544),n(p,{type:"primary",loading:e.uploading,onClick:C},{default:r(()=>t[1]||(t[1]=[d("上传图片")])),_:1,__:[1]},8,["loading"]),n(p,{type:"primary",loading:e.uploading,onClick:k},{default:r(()=>t[2]||(t[2]=[d(" 上传DCM ")])),_:1,__:[2]},8,["loading"]),n(p,{type:"primary",onClick:E,loading:e.loading},{default:r(()=>t[3]||(t[3]=[d("提交")])),_:1,__:[3]},8,["loading"]),n(p,{type:"primary",onClick:b},{default:r(()=>t[4]||(t[4]=[d("重置")])),_:1,__:[4]})]),_:1}),n(s,{label:"提示词"},{default:r(()=>[n(D,{modelValue:e.text,"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),rows:5,type:"textarea",placeholder:"请输入症状用于智能导诊"},null,8,["modelValue"])]),_:1})]),_:1})]),m("div",G,[(i(!0),o(u,null,f(e.messages,l=>{var c;return i(),o("div",{class:N([{user:l.role==="user",assistant:l.role==="assistant"},"item"])},[(c=l.images)!=null&&c.length?(i(),o("div",O,[(i(!0),o(u,null,f(l.images,V=>(i(),o("span",j,[m("img",{src:V,height:"100",class:"img"},null,8,q)]))),256))])):_("",!0),d(" "+R(l.content),1)],2)}),256))])],64)}}},Z=S(H,[["__scopeId","data-v-7c064359"]]);export{Z as default};
